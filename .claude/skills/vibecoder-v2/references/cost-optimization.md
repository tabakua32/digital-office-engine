# Оптимізація вартості Claude Code

## Орієнтири вартості

| Метрика | Значення |
|---|---|
| Середня вартість | ~$6/розробник/день |
| 90% користувачів | < $12/день |
| Приблизно | $100–200/місяць |
| Max план (важкі юзери) | Економія до 93% vs API |

---

## MECE матриця важелів оптимізації

### Важіль 1 — Вибір моделі (найбільший ефект)

| Задача | Модель | Відносна вартість |
|---|---|---|
| Рутинний код, тести | Sonnet 4.6 | 1× |
| Архітектурні рішення | Opus 4.6 | 5× |
| Subagents | Sonnet 4.6 (завжди) | 1× |
| Plan Mode | `opusplan` alias (Opus → Sonnet) | Гібрид |

```bash
# opusplan alias: Opus під час планування, Sonnet під час виконання
export CLAUDE_CODE_SUBAGENT_MODEL="claude-sonnet-4-6"
```

### Важіль 2 — Cache (до 83% економії)

**Правила збереження кешу:**
1. Працюй у фокусних блоках 30–60 хвилин
2. Завантаж всі потрібні файли на початку сесії
3. НЕ редагуй файли вручну під час сесії → ламає кеш
4. НЕ виходь-заходь з короткими запитаннями → кеш тухне за 5–15 хв
5. Тримай файли невеликими

**Ціль:** Cache Read / Total Input ratio → **60–80%**

### Важіль 3 — Контекст

| Дія | Економія |
|---|---|
| `/clear` між незв'язаними задачами | Усуває накопичений контекст |
| Skills vs everything-in-CLAUDE.md | ~15 000 токенів/сесію |
| Батчинг пов'язаних змін | "Оновити обробку помилок у auth.js, user.js, api.js" (1 запит ≠ 3) |
| `@file` замість широкого пошуку | Claude не сканує зайвого |

**Конкретні числа (виміряні):** 8 оптимізаційних точок контексту → **55% зниження токенів + 60% швидших відповідей**.

### Важіль 4 — Моніторинг

| Інструмент | Як |
|---|---|
| `/cost` | Статистика поточної сесії |
| `ccusage` | `npm install -g @ryoppippi/ccusage` — денні зрізи |
| `claude-monitor` | Real-time відстеження |

---

## Рішення по плану (Max vs API)

| Щоденне використання | Рекомендація |
|---|---|
| < $3/день | API або Pro |
| $3–10/день | Max план ($100/міс) |
| > $10/день | Max план + оптимізація |

---

## Топ-5 помилок що коштують грошей

1. **Ручне редагування файлів під час сесії** — кеш зламаний → ×10 витрати
2. **Сесії > 1 год без `/clear`** — платиш за стале контекст у кожному повідомленні
3. **10+ MCP серверів** — 20k+ токенів MCPs = 20k для роботи
4. **Opus для рутини** — 5× вартість без потреби
5. **Subagents без бюджету** — 7× токени vs стандартна сесія
